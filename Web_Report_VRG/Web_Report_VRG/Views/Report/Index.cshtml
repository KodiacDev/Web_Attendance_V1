@* Tiêu đề trang *@
@{
    ViewData["Title"] = "Thống Kê Sản Lượng Mủ";
}

@section Styles {
    <!-- Nhúng CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="~/css/report.css">
}

<div class="container mt-4 thong-ke-wrapper">
    <!-- Instructions Section -->
    <div class="instructions-section">
        <h5 class="text-primary">THAO TÁC ĐỂ XEM THỐNG KÊ</h5>
        <div class="row g-3 align-items-end">
            <div class="col-md-2">
                <label for="nam" class="form-label">Mùa vụ *</label>
                <select id="nam" class="form-select form-input-custom" onchange="CheckAndReloadData()">
                    <option value="">-- Chọn --</option>
                    <option value="2025">2025-2026</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="maCongNhan" class="form-label">Mã công nhân *</label>
                <select id="maCongNhan" class="form-select form-input-custom" onchange="CheckAndReloadData()">
                    <option value="">-- Chọn --</option>
                    <option value="7">CN1</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="ngayCao_phien" class="form-label">Ngày cạo *</label>
                <input type="date" id="ngayCao_phien" class="form-control form-input-custom" value="2025-06-30" onchange="CheckAndReloadData()">
            </div>
            <div class="col-md-2">
                <label for="phien" class="form-label">Phiên *</label>
                <select id="phien" class="form-select form-input-custom" onchange="CheckAndReloadData()">
                    <option value="">-- Chọn --</option>
                    <option value="45">D | Chế độ cạo: 13</option>
                </select>
            </div>
            <div class="col-md-2 d-grid">
                <button id="btnLoc" class="btn btn-search h-100">
                    <i class="fas fa-search me-1"></i>Tìm kiếm
                </button>
            </div>
        </div>
        <p class="note">
            Chọn đầy đủ thông tin trước <span style="font-weight: bold;">có dấu *</span> để hiển thị dữ liệu thống kê!
        </p>
    </div>

    <!-- Accordion chứa tất cả các section -->
    <div class="accordion my-3" id="mainAccordion">
        <!-- Section: Biểu đồ theo phiên -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPhien">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePhien" style="background-color: #DCF7DE">
                    <h5 class="text-brown text-uppercase m-0">
                        <i class="fa-solid fa-chart-line me-1 text-primary"></i><b>Biểu đồ theo phiên</b>
                    </h5>
                </button>
            </h2>
            <div id="collapsePhien" class="accordion-collapse collapse" aria-labelledby="headingPhien">
                <div class="accordion-body">
                    <div class="card shadow-sm" style="background: #E4F3F4;">
                        <div class="card-body">
                            <div class="filter-section">
                                <h5 class="card-title text-primary">Biểu đồ theo phiên</h5>
                            </div>
                            <div id="chart_theo_phien_ngay" class="chart-container"></div>
                        </div>
                        <div class="card-arrow">
                            <div class="card-arrow-top-left"></div>
                            <div class="card-arrow-top-right"></div>
                            <div class="card-arrow-bottom-left"></div>
                            <div class="card-arrow-bottom-right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Biểu đồ sản lượng -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingSanLuong">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSanLuong" style="background-color: #DCF7DE">
                    <h5 class="text-brown text-uppercase m-0">
                        <i class="fa-solid fa-chart-line me-1 text-primary"></i><b>Biểu đồ sản lượng</b>
                    </h5>
                </button>
            </h2>
            <div id="collapseSanLuong" class="accordion-collapse collapse" aria-labelledby="headingSanLuong">
                <div class="accordion-body">
                    <div class="card shadow-sm" style="background: #E4F3F4;">
                        <div class="card-body">
                            <div class="filter-section">
                                <h5 class="card-title text-primary">Biểu đồ sản lượng</h5>
                            </div>
                            <div id="bieu_do_san_luong" class="chart-container"></div>
                        </div>
                        <div class="card-arrow">
                            <div class="card-arrow-top-left"></div>
                            <div class="card-arrow-top-right"></div>
                            <div class="card-arrow-bottom-left"></div>
                            <div class="card-arrow-bottom-right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section: Bảng chi tiết sản lượng -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingChiTiet">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseChiTiet" style="background-color: #DCF7DE">
                    <h5 class="text-brown text-uppercase m-0">
                        <i class="fa-solid fa-chart-line me-1 text-primary"></i><b>Bảng chi tiết sản lượng</b>
                    </h5>
                </button>
            </h2>
            <div id="collapseChiTiet" class="accordion-collapse collapse" aria-labelledby="headingChiTiet">
                <div class="accordion-body">
                    <div class="card shadow-sm" style="background: #E4F3F4;">
                        <div class="card-body">
                            <div class="filter-section">
                                <h5 class="card-title text-primary">Bảng chi tiết sản lượng</h5>
                            </div>
                            <div id="bang_chi_tiet" class="table-responsive chart-container">
                                <div class="row my-1">
                                    <div class="data-management first_view" data-id="table">
                                        <hr />
                                        <!-- Bảng sẽ được JavaScript tự động bơm vào qua id -->
                                        <div id="table_total_weight_farmgroup"></div>
                                        <hr />
                                    </div>
                                    <div class="chart-wrapper">
                                        <div id="chart_total_weight_farmgroup" class="chart-container"></div>    
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-arrow">
                            <div class="card-arrow-top-left"></div>
                            <div class="card-arrow-top-right"></div>
                            <div class="card-arrow-bottom-left"></div>
                            <div class="card-arrow-bottom-right"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Nhúng các thư viện JavaScript -->
    <script src="https://cdn.datatables.net/2.3.1/js/dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-bs5/1.13.6/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="~/controllers/report.js"></script>
}